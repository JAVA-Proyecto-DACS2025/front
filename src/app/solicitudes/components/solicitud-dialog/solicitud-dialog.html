<!-- Nuevas pestañas arriba del diálogo -->
<mat-tab-group>
  <mat-tab label="Cirugía">
    <div mat-dialog-content class="dialog-content" [formGroup]="form">
      <div class="content-dialog">
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label>Paciente</mat-label>
          <input matInput formControlName="paciente" [matAutocomplete]="auto" required />
          <mat-autocomplete
            #auto="matAutocomplete"
            [displayWith]="displayPaciente"
            (optionSelected)="onPacienteSelected($event)"
          >
            <mat-option *ngFor="let option of pacienteOptions$ | async" [value]="option">
              {{ option.dni }} - {{ option.nombre }}
            </mat-option>
            <mat-option *ngIf="(pacienteOptions$ | async)?.length === 0" disabled>No hay resultados</mat-option>
          </mat-autocomplete>
          <mat-error *ngIf="form.get('pacienteId')?.hasError('required')">Paciente es requerido</mat-error>
        </mat-form-field>

        <!-- servicio -->
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label>servicio</mat-label>
          <input matInput formControlName="servicio" required />
          <mat-error *ngIf="form.get('servicio')?.hasError('required')">Servicio es requerido</mat-error>
        </mat-form-field>

        <!-- Fecha y Hora -->
        <div style="display:flex; gap:12px; align-items:start;">
          <mat-form-field appearance="outline" style="flex:1">
            <mat-label>Fecha</mat-label>
            <input matInput [matDatepicker]="picker" formControlName="fecha_hora_inicio" (focus)="picker.open()" required />
            <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
            <mat-datepicker #picker></mat-datepicker>
            <mat-error *ngIf="form.get('fecha_hora_inicio')?.hasError('required')">Fecha es requerida</mat-error>
          </mat-form-field>

          <mat-form-field appearance="outline" style="width:140px">
            <mat-label>Hora</mat-label>
            <input matInput type="time" formControlName="hora" required />
            <mat-error *ngIf="form.get('hora')?.hasError('required')">Hora es requerida</mat-error>
          </mat-form-field>
        </div>

        <!-- Estado -->
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label>Estado</mat-label>
          <input matInput formControlName="estado" required />
          <mat-error *ngIf="form.get('estado')?.hasError('required')">Estado es requerido</mat-error>
        </mat-form-field>

        <!-- Prioridad -->
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label>Prioridad</mat-label>
          <input matInput formControlName="prioridad" required />
          <mat-error *ngIf="form.get('prioridad')?.hasError('required')">Prioridad es requerida</mat-error>
        </mat-form-field>

        <!-- Tipo -->
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label>Tipo</mat-label>
          <input matInput formControlName="tipo" required />
          <mat-error *ngIf="form.get('tipo')?.hasError('required')">Tipo es requerido</mat-error>
        </mat-form-field>

        <!-- Sala / Quirófano -->
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label>Sala</mat-label>
          <input matInput formControlName="quirofano" inputmode="numeric" required />
          <mat-error *ngIf="form.get('quirofanoId')?.hasError('required')">Sala es requerida</mat-error>
        </mat-form-field>

        <!-- Anestesia -->
        <mat-form-field appearance="outline" style="width: 100%">
          <mat-label>Anestesia</mat-label>
          <input matInput formControlName="anestesia" required />
          <mat-error *ngIf="form.get('anestesia')?.hasError('required')">Anestesia es requerida</mat-error>
        </mat-form-field>

        <!-- Equipo médico -->
        <!-- si equipoMedico es requerido mostramos error -->
        <ng-template #eqError>
          <mat-error *ngIf="form.get('equipoMedico')?.hasError('required')">Equipo médico es requerido</mat-error>
        </ng-template>
      </div>
    </div>
  </mat-tab>

  <mat-tab label="Equipo médico">
    <!-- Contenido para equipo médico: placeholder, agrega controles según tu data -->
    <div class="dialog-content" style="padding:16px;">
      <p style="margin:0 0 8px 0">Agregar miembros del equipo médico asociados a la cirugía.</p>

      <!-- Ejemplo simple: lista y botón para abrir selector (implementar en TS) -->
      <div *ngIf="equipo?.length; else none">
        <mat-list>
          <mat-list-item *ngFor="let m of equipo">
            {{ m.rol }} - {{ m.nombre }}
            <button mat-icon-button color="warn" (click)="removeMiembro(m)" matTooltip="Eliminar miembro">
              <mat-icon>delete</mat-icon>
            </button>
          </mat-list-item>
        </mat-list>
      </div>
      <ng-template #none>
        <p class="muted">No hay miembros agregados.</p>
      </ng-template>

      <div style="margin-top:12px;">
        <button mat-stroked-button color="primary" type="button" (click)="openEquipoSelector()">
          Agregar miembro
        </button>
      </div>
    </div>
  </mat-tab>
</mat-tab-group>

<div mat-dialog-actions align="end">
  <button mat-raised-button color="primary" type="button" (click)="cancelar()">Cancelar</button>
  <button mat-raised-button color="primary" (click)="guardar()">Guardar</button>
</div>
