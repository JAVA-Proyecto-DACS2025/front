<div class="home-container">
  <div class="header">
    <h1>{{ title }}</h1>
    @if (isLoggedIn) {
      <p>Bienvenido, {{ keycloakService.getFullName() }}</p>
    } @else {
      <p>Inicia sesi贸n para acceder a las funcionalidades</p>
    }
  </div>

  <!-- Estado de autenticaci贸n -->
  @if (!isLoggedIn) {
    <div class="auth-status">
      <div class="auth-card">
        <div class="auth-icon"></div>
        <h3>Autenticaci贸n Requerida</h3>
        <p>
          Para acceder a las funcionalidades de la aplicaci贸n, necesitas iniciar sesi贸n con Keycloak.
        </p>
        <button (click)="login()" class="login-button">
          <span class="button-icon"></span>
          Iniciar Sesi贸n con Keycloak
        </button>
      </div>
    </div>
  }

  <!-- Contenido con Tabs -->
  @if (isLoggedIn) {
    <div class="content-tabs">
      <mat-tab-group [(selectedIndex)]="selectedTab" animationDuration="200ms">
        <!-- Tab Agenda -->
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon>calendar_month</mat-icon>
            <span>Agenda</span>
          </ng-template>
          <div class="tab-content">
            <app-agenda></app-agenda>
          </div>
        </mat-tab>

        <!-- Tab M茅tricas -->
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon>analytics</mat-icon>
            <span>M茅tricas</span>
          </ng-template>
          <div class="tab-content">
            <div class="metrics-container">
              <h2>M茅tricas del Sistema</h2>
              <div class="metrics-grid pretty-metrics">
                <div class="metric-card pretty-card">
                  <mat-icon class="metric-icon">people</mat-icon>
                  <div class="metric-value pretty-value">{{ estadisticas?.totalPacientes ?? '-' }}</div>
                  <div class="metric-label">Total Pacientes</div>
                </div>
                <div class="metric-card pretty-card">
                  <mat-icon class="metric-icon">pending_actions</mat-icon>
                  <div class="metric-value pretty-value">{{ estadisticas?.cirugiasPendientes ?? '-' }}</div>
                  <div class="metric-label">Cirug铆as Pendientes</div>
                </div>
                <div class="metric-card pretty-card">
                  <mat-icon class="metric-icon">today</mat-icon>
                  <div class="metric-value pretty-value">{{ estadisticas?.cirugiasHoy ?? '-' }}</div>
                  <div class="metric-label">Cirug铆as Hoy</div>
                </div>
                <div class="metric-card pretty-card">
                  <mat-icon class="metric-icon">date_range</mat-icon>
                  <div class="metric-value pretty-value">{{ estadisticas?.cirugiasEstaSemana ?? '-' }}</div>
                  <div class="metric-label">Cirug铆as Esta Semana</div>
                </div>
                <div class="metric-card wide pretty-card">
                  <mat-icon class="metric-icon">meeting_room</mat-icon>
                  <div class="metric-label">Quir贸fanos Activos</div>
                  <ul class="quirofano-list" *ngIf="estadisticas">
                    <li *ngFor="let q of (estadisticas?.quirofanosDisponibles || []).concat(estadisticas?.quirofanosEnUso || [])">
                      <span class="quirofano-nombre" [ngStyle]="{color: (q.estado && q.estado.toLowerCase().includes('disponible')) ? '#43a047' : '#e53935', 'font-weight': 'bold'}">
                        {{ q.nombre }}
                      </span>
                    </li>
                  </ul>
                  <span *ngIf="!(estadisticas?.quirofanosDisponibles?.length || estadisticas?.quirofanosEnUso?.length)" class="no-data">Ninguno</span>
                </div>
              </div>
              <div *ngIf="!estadisticas" class="metrics-note">Cargando m茅tricas...</div>
            </div>
          </div>
        </mat-tab>

        <!-- Tab Reportes -->
        <mat-tab>
          <ng-template mat-tab-label>
            <mat-icon>description</mat-icon>
            <span>Reportes</span>
          </ng-template>
          <div class="tab-content">
            <div class="reports-container">
              <h2>Reportes Disponibles</h2>
              <div class="reports-list">
                <div class="report-item">
                  <mat-icon>summarize</mat-icon>
                  <div class="report-info">
                    <span class="report-name">Reporte de cirug铆as mensuales</span>
                    <span class="report-desc">Resumen de todas las cirug铆as del mes</span>
                  </div>
                  <button class="report-btn">Generar</button>
                </div>
                <div class="report-item">
                  <mat-icon>person</mat-icon>
                  <div class="report-info">
                    <span class="report-name">Reporte de personal</span>
                    <span class="report-desc">Actividad del personal m茅dico</span>
                  </div>
                  <button class="report-btn">Generar</button>
                </div>
                <div class="report-item">
                  <mat-icon>meeting_room</mat-icon>
                  <div class="report-info">
                    <span class="report-name">Uso de quir贸fanos</span>
                    <span class="report-desc">Ocupaci贸n y disponibilidad</span>
                  </div>
                  <button class="report-btn">Generar</button>
                </div>
              </div>
            </div>
          </div>
        </mat-tab>
      </mat-tab-group>
    </div>

    <!-- Informaci贸n de roles del usuario -->
    <div class="user-roles">
      <h4>Roles asignados:</h4>
      <div class="roles-list">
        @for (role of keycloakService.getUserRoles(); track role) {
          <span
            class="role-badge"
            [class.role-a]="role === 'ROLE-A'"
            [class.role-b]="role === 'ROLE-B'"
            [class.other-role]="role !== 'ROLE-A' && role !== 'ROLE-B'"
          >
            {{ role }}
          </span>
        }
      </div>
    </div>
  }

  <div class="footer">
    <p>DACS Frontend - Sistema de Pruebas con Keycloak</p>
  </div>
</div>
